
pipeline {
    agent any
    /* environment {
            registry = "salma2705"
            registryCredential = 'dockerhubId'
            dockerImage = ''

     }*/
   
    stages {
        stage('Checkout GIT') {
            steps {
                echo 'Pulling'
               git branch: 'salma', credentialsId: 'jenkinks_cred', url: 'https://github.com/ibtchy/ProjetDevOps.git'
            }
        }

         stage ('mvn Compile'){
            steps {
                 sh 'mvn compile -e'
            }
        }


        stage ('test'){
        steps{
            sh 'mvn test -Dtest="tn.esprit.spring.services.FactureServiceTestMock.java"'
        }
        }


       stage("SonarQube"){
        steps {
                withSonarQubeEnv ( installationName: 'SonarQube'){
                sh 'mvn sonar:sonar'
                }
        }
        }


       stage ('Nexus'){
                steps{
                    sh 'mvn deploy -DskipTests'

                }
        }


        //docker build
       /* stage('Docker image build') {
                 steps {
                        script {
                            dockerImage = docker.build registry + ":$BUILD_NUMBER"
                        }
                    }
                }

         stage('Image Deploy') {
                  steps {
                        script {
                            docker.withRegistry( '', registryCredential ) {
                            dockerImage.push()
                        }
                       }
                    }
                }

         stage('clean') {
                steps {
                        sh "docker rmi $registry:$BUILD_NUMBER"
                }
                }

            }*/

    }
}
